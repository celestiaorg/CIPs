| cip | 46 |
| - | - |
| title | ZK Interchain Security Module |
| description | Proof-based Hyperlane ISM using SP1 Groth16 verification |
| author | Manav Aggarwal ([@Manav-Aggarwal](https://github.com/Manav-Aggarwal)) |
| discussions-to | TBD |
| status | Draft |
| type | Standards Track |
| category | Core |
| created | 2025-01-20 |

## Abstract

This proposal introduces a ZK-based Hyperlane Interchain Security Module (`x/zkism`) that enables trust-minimized cross-chain message verification using SP1 Groth16 zero-knowledge proofs. The module allows external networks to securely transfer assets through Celestia without relying on trusted operators or multisigs.

## Motivation

Hyperlane's most widely deployed Interchain Security Module is the Multisig ISM, which relies on a trusted set of validators to attest to cross-chain messages. While functional, this creates a trust bottleneck: trading apps that need non-native liquidity must trust external parties to relay assets correctly.

A ZK-based Hyperlane ISM replaces validator trust with cryptographic proof verification. Prover programs are written in SP1, with proofs generated via the Succinct Prover Network. This gives ecosystem networks a secure, proof-based path to transfer assets through Celestia without trusting a multisig.

The module enables:

- Orderbook exchanges to access non-native liquidity without trusting external parties
- Proof-based verification of cross-chain state transitions
- Trust-minimized message authorization for Hyperlane routing

## Specification

The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in RFC 2119 and RFC 8174.

### Module Overview

The `x/zkism` module implements a Hyperlane Interchain Security Module that maintains opaque state along with SP1 Groth16 verifier configuration. The first 32 bytes of state serve as a trusted state root used for membership verification.

### State

The module maintains two collections:

1. **ISMs**: Per-ISM records containing ownership, current state, and verifier configurations
2. **Messages**: Authorized message IDs awaiting consumption by the Hyperlane router

### Message Types

#### MsgCreateInterchainSecurityModule

Creates a new ZK ISM with initial trusted state and verifier keys.

Fields:

- `creator`: Transaction signer
- `state`: Initial trusted state (minimum 32 bytes)
- `merkle_tree_address`: Merkle tree address (32 bytes)
- `groth16_vkey`: SP1 Groth16 verifier key
- `state_transition_vkey`: Program verifier key commitment for state transitions (32 bytes)
- `state_membership_vkey`: Program verifier key commitment for state membership (32 bytes)

#### MsgUpdateInterchainSecurityModule

Updates ISM state through a verified state transition proof.

Fields:

- `id`: ISM identifier
- `proof`: Groth16 proof bytes
- `public_values`: Public values for proof verification
- `signer`: Transaction signer

#### MsgSubmitMessages

Authorizes Hyperlane messages through a verified state membership proof.

Fields:

- `id`: ISM identifier
- `proof`: Groth16 proof bytes
- `public_values`: Public values for proof verification
- `signer`: Transaction signer

### Proof Types

The module processes two proof categories:

1. **StateTransitionValues**: Enables state updates through cryptographic proof verification
2. **StateMembershipValues**: Authorizes specific Hyperlane message IDs for processing

### SP1 Groth16 Verification

The verifier operates on 260-byte proofs: 4-byte prefix + 256-byte Groth16 proof payload. The prefix MUST validate against the verifying key hash. Public witnesses combine the program verification key commitment and hashed public values as field elements in the BN254 curve.

### Hyperlane Integration

The module integrates with Hyperlane's router through the `Verify` method, which checks authorized message IDs and consumes them upon authorization. This prevents replay attacks by ensuring each message can only be processed once.

### Queries

- `Ism`: Get a single ISM by ID
- `Isms`: List all ISMs with pagination
- `Messages`: Get authorized messages for an ISM

### Events

- `EventCreateInterchainSecurityModule`: Emitted when creating a new ISM
- `EventUpdateInterchainSecurityModule`: Emitted when updating ISM state
- `EventSubmitMessages`: Emitted when messages are authorized

## Rationale

### Why Hyperlane ISM Pattern

Hyperlane's ISM architecture provides a modular security framework where different verification methods can be plugged in. The ZK ISM extends this by adding cryptographic proof verification as an alternative to multisig-based security.

### Why SP1 and Groth16

SP1 enables writing prover programs in Rust, making it accessible to developers familiar with the Cosmos ecosystem. Groth16 provides constant-size proofs (256 bytes) with fast verification, suitable for on-chain verification where gas costs matter.

### Why Generic Verifier Design

The module stores verifier configurations per-ISM rather than hardcoding them. This allows different networks to use different prover programs while sharing the same verification infrastructure on Celestia.

## Backwards Compatibility

This is a consensus-breaking change that requires a network upgrade. However, it is purely additive and does not affect existing functionality or other modules.

## Security Considerations

1. **Honest-but-untrusted prover assumption**: The design assumes provers generate valid proofs but may attempt to submit proofs for unauthorized state transitions. The cryptographic verification ensures only valid proofs are accepted.

2. **One-time message consumption**: Authorized messages are removed from storage after verification, preventing replay attacks where the same proof could authorize the same message multiple times.

3. **Proof prefix validation**: The 4-byte proof prefix MUST match the verifying key hash to prevent proofs generated for one verifier from being used with another.

4. **Cryptographic implementation dependency**: Security relies on correct implementation of Groth16 verification and the BN254 curve operations. The module uses audited cryptographic libraries.

5. **State root integrity**: The first 32 bytes of ISM state serve as the trusted root for membership proofs. State transitions MUST be verified before updating this root.

## Reference Implementation

The reference implementation is available at: <https://github.com/celestiaorg/celestia-app/pull/6438>

## Copyright

Copyright and related rights waived via [CC0](https://github.com/celestiaorg/CIPs/blob/main/LICENSE).
