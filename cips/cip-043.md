| cip | 43 |
| - | - |
| title | Fee address module |
| description | Contribute TIA tokens to protocol fee revenue via a vanity fee address |
| author | Manav Aggarwal ([@Manav-Aggarwal](https://github.com/Manav-Aggarwal)) |
| discussions-to | <https://forum.celestia.org/t/cip-add-burn-module/2216> |
| status | Draft |
| type | Standards Track |
| category | Core |
| created | 2025-01-14 |

## Abstract

This proposal introduces a fee address module (`x/feeaddress`) that allows users to contribute TIA tokens to protocol fee revenue by sending them to a vanity fee address. Tokens sent to this address are automatically forwarded to the fee collector at the end of each block.

## Motivation

The fee address mechanism enables applications to easily contribute to protocol fee revenue. For example, rollups could forward a portion of blob fees, or applications could share revenue with the protocol. Using a fee address rather than a specialized message simplifies the user experience—users can contribute with a standard `bank send` transaction.

## Specification

The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in RFC 2119 and RFC 8174.

### New Module: `x/feeaddress`

The fee address module manages a special fee address and forwards received tokens to the fee collector.

### Fee Address

```text
celestia1feefeefeefeefeefeefeefeefeefeefe8pxlcf
```

This is a vanity address that encodes to "fee" repeated multiple times, making it recognizable as a fee destination. The address has no known private key, ensuring tokens sent there can only be handled by the module.

### State

The fee address module is stateless. It does not track cumulative forwarded tokens.

### Supported Transfer Methods

- **Bank Send**: `MsgSend` and `MsgMultiSend` with fee address as recipient
- **IBC Transfer**: `MsgTransfer` with fee address as receiver (inbound transfers validated by middleware)
- **Hyperlane**: Inbound transfers landing at fee address are forwarded

### Validation: FeeAddressDecorator

The `FeeAddressDecorator` ante handler validates transactions containing:

- `MsgSend` - checks `ToAddress`
- `MsgMultiSend` - checks all `Outputs[].Address`
- `MsgTransfer` (IBC) - checks `Receiver`
- `MsgExec` (authz) - recursively validates all nested messages

If recipient is the fee address, only `utia` denomination is allowed. Transactions attempting to send non-utia tokens to the fee address are rejected.

### Validation: FeeAddressIBCMiddleware

The `FeeAddressIBCMiddleware` intercepts inbound IBC transfers (`OnRecvPacket`). If the receiver is the fee address:

- **Allowed**: Native `utia` (including utia returning from other chains with IBC prefixes like `transfer/channel-0/utia`)
- **Rejected**: Foreign tokens (e.g., `uosmo`, `uatom`, or any non-utia denom)

Rejected transfers receive an error acknowledgement, causing the sender to be refunded on the source chain.

### EndBlocker

At the end of each block:

1. Check fee address `utia` balance
2. If zero, return early (no-op)
3. Transfer tokens from fee address to fee collector module account
4. Emit `EventFeeForwarded` with sender address and amount

**Note:** Protocol fee revenue is currently distributed to validators as staking rewards via the distribution module. This distribution mechanism may change in the future through governance.

### Queries

#### FeeAddress

Returns the fee address for programmatic discovery.

```shell
grpcurl -plaintext localhost:9090 celestia.feeaddress.v1.Query/FeeAddress
```

### Event

```protobuf
message EventFeeForwarded {
  string sender = 1;  // Fee address
  string amount = 2;  // Amount forwarded (e.g., "1000000utia")
}
```

### CLI Usage

```shell
# Bank send
celestia-appd tx bank send <from-key> celestia1feefeefeefeefeefeefeefeefeefeefe8pxlcf 1000000utia

# IBC transfer
celestia-appd tx ibc-transfer transfer <channel> celestia1feefeefeefeefeefeefeefeefeefeefe8pxlcf 1000000utia --from <key>
```

## Parameters

This module introduces no new parameters.

## Rationale

The fee address approach offers several advantages over a dedicated message:

1. **Simplicity**: Users contribute with standard `bank send` rather than learning a new message type
2. **Interoperability**: Supports forwarding via IBC transfers and Hyperlane without additional message types
3. **Tooling Compatibility**: Works with existing wallets and tools that support bank sends
4. **Discoverability**: The vanity address ("fee" repeated) clearly conveys "tokens go to fees"
5. **Fee Revenue**: Forwarded tokens contribute to protocol fee revenue

The module is intentionally stateless—it does not track cumulative forwarded tokens. This simplifies the implementation and avoids state bloat.

## Backwards Compatibility

This is a consensus-breaking change that requires a network upgrade. However, it is purely additive (new module, new ante decorator, new IBC middleware) and does not affect existing functionality.

## Test Cases

Test cases are available in the reference implementation:

- Unit tests: `x/feeaddress/keeper_test.go` (EndBlocker, event emission, error handling)
- Ante decorator tests: `x/feeaddress/ante/fee_address_decorator_test.go` (MsgSend, MsgMultiSend, MsgTransfer, MsgExec validation)
- IBC middleware tests: `app/ibc_fee_middleware_test.go` (utia allowed, non-utia rejected, multi-hop scenarios)
- Integration tests: `x/feeaddress/test/feeaddress_test.go` (full send-and-forward flow, query tests)

## Security Considerations

1. **Denom Restriction**: Only `utia` can be sent to the fee address. This is enforced by `FeeAddressDecorator` (for local transactions) and `FeeAddressIBCMiddleware` (for IBC transfers). This prevents forwarding of IBC tokens, Hyperlane tokens, or any other bridged assets. Forwarding bridged assets would cause accounting discrepancies between chains.

2. **Spam Mitigation**: No rate limiting is implemented as gas costs naturally discourage spam.

3. **ICA Bypass (Accepted Risk)**: ICA host messages bypass the ante handler chain. If an ICA controller on another chain executes `MsgSend` with the fee address as recipient, the fee address restriction is not enforced. Non-utia tokens sent this way would be permanently stuck (not forwarded, not stolen). This is documented and accepted because:
   - Stuck tokens do not benefit any party (they are not stolen, just inaccessible)
   - ICA usage is uncommon and requires explicit controller setup on another chain
   - The operational complexity of mitigating this edge case outweighs the risk

4. **Hyperlane Inbound**: Hyperlane `MsgProcessMessage` bypasses ante handlers. Non-utia tokens bridged to the fee address via Hyperlane would be permanently stuck. Users should avoid sending non-utia to the fee address via Hyperlane.

## Reference Implementation

The implementation is available at: <https://github.com/celestiaorg/celestia-app/pull/6407>

## Copyright

Copyright and related rights waived via [CC0](https://github.com/celestiaorg/CIPs/blob/main/LICENSE).
