| cip | 43 |
| - | - |
| title | Fee address module |
| description | Forward TIA tokens to protocol revenue via a dedicated fee address |
| author | Manav Aggarwal ([@Manav-Aggarwal](https://github.com/Manav-Aggarwal)) |
| discussions-to | <https://forum.celestia.org/t/cip-add-burn-module/2216> |
| status | Draft |
| type | Standards Track |
| category | Core |
| created | 2025-01-14 |

## Abstract

This proposal introduces a fee address module (`x/feeaddress`) that allows users to send TIA tokens to a dedicated address, which are then automatically forwarded to the fee collector module as transaction fees via protocol-injected transactions. These fees are distributed to validators and delegators through the existing distribution module.

## Motivation

External networks using Celestia for data availability may want to contribute fee revenue to Celestia. However, they face fundamental operational constraints.

Networks typically don't maintain a funded account on Celestia with signing keys. Setting up a custodian or multisig on Celestia adds significant operational overhead. Their only access to Celestia is through cross-chain bridges like IBC or Hyperlane. However, these bridges can only deliver tokens to a recipient address—they cannot submit transactions with custom fee amounts.

This creates a gap: networks can bridge TIA to Celestia, but cannot convert those tokens into protocol revenue without maintaining Celestia-side infrastructure.

The fee address solves this by providing a dedicated address where:

- Networks send TIA via any bridge (IBC, Hyperlane, etc.)
- Tokens are automatically converted to protocol revenue via protocol-injected transactions
- Contributions appear in dashboard revenue calculations (e.g., Blockworks, Celenium) without requiring integration changes from dashboard providers

### Dashboard Compatibility Constraint

Blockchain analytics dashboards calculate protocol revenue by aggregating the `tx.AuthInfo.Fee` field across all transactions. A simpler design using direct bank transfers would not appear in these revenue calculations. The protocol-injected transaction approach ensures contributions appear as real transaction fees without requiring dashboard providers to add special-case logic.

## Non-Goals

This CIP intentionally does **not** address:

- **Fee distribution mechanism**: How collected fees are allocated (delegators, community pool, burn) is a broader tokenomics decision affecting all protocol revenue, not just external contributions
- **Minimum contribution threshold**: Small amounts (even 1 utia) trigger forwarding immediately; batching adds complexity for marginal benefit
- **Multi-denom support**: Only `utia` is accepted; foreign tokens would become permanently stuck
- **Burning tokens**: This CIP forwards to revenue; a separate CIP could propose burning collected fees

## Specification

The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in RFC 2119 and RFC 8174.

### New Module: `x/feeaddress`

The fee address module is intentionally stateless and relies entirely on existing Cosmos SDK modules for token operations.

### Fee Address

Tokens MUST be sent to the following vanity address:

```
celestia1feefeefeefeefeefeefeefeefeefeefe8pxlcf
```

This address is derived from a recognizable byte pattern that encodes to "feefee..." in bech32, making it easily identifiable as a fee destination.

### Message Types

#### MsgForwardFees

This message is protocol-injected and MUST NOT be submitted by users directly.

```protobuf
message MsgForwardFees {}
```

The message has no signer and no fields. Validation happens entirely via ProcessProposal checking that `tx fee == fee address balance`.

### Validation Rules

The following ante decorators and IBC middleware enforce token restrictions:

- Only `utia` (the native staking token) MAY be sent to the fee address
- Attempts to send other denoms MUST be rejected
- IBC transfers of non-utia tokens to the fee address are rejected to prevent foreign tokens from getting stuck (utia sent via IBC is allowed)

### Protocol-Injected Fee Forward Transaction

#### PrepareProposal

When preparing a block proposal, the block proposer:

1. Queries the fee address `utia` balance
2. If balance is non-zero:
   - Creates a `MsgForwardFees` transaction
   - Sets the transaction fee to the **entire fee address balance**
   - Sets gas limit to 50,000 (minimal, no computation)
   - Does NOT sign the transaction (unsigned)
   - Prepends the transaction to the block

Note: The fee forward tx is minimal (~100 bytes). If a block cannot accommodate it (practically impossible), tokens remain in the fee address until the next block.

#### ProcessProposal (Strict Validation)

PrepareProposal is proposer-controlled, so ProcessProposal MUST independently verify fee forwarding to prevent malicious proposers from withholding funds.

All validators MUST enforce strict validation:

1. If fee address has a non-zero balance:
   - Block MUST contain a valid `MsgForwardFees` tx as the **first transaction**
   - Tx fee MUST equal the fee address balance
   - Block is REJECTED if any of these conditions fail
2. If fee address has zero balance:
   - Block MUST NOT contain a `MsgForwardFees` tx
   - Block is REJECTED if a fee forward tx is present

#### Ante Handler: FeeForwardDecorator

The `FeeForwardDecorator` processes `MsgForwardFees` transactions:

1. Deducts the transaction fee from the fee address (not from a signer)
2. Sends the fee to the fee collector module
3. Bypasses signature and sequence checks (the tx is unsigned and protocol-injected)

The fee forward transaction skips standard ante decorators for fee deduction, min gas price validation, signature verification, and sequence increment. See the reference implementation for the complete bypass list.

### Distribution

Forwarded fees are sent to the fee collector module. The distribution module allocates fee collector funds to validators and their delegators proportionally at `BeginBlock`. This distribution mechanism may be modified in future protocol upgrades.

### Event

```protobuf
message EventFeeForwarded {
  string from = 1;    // Address tokens were forwarded from
  string amount = 2;  // Amount forwarded (e.g., "1000000utia")
}
```

### Query

```protobuf
service Query {
  rpc FeeAddress(QueryFeeAddressRequest) returns (QueryFeeAddressResponse);
}

message QueryFeeAddressRequest {}

message QueryFeeAddressResponse {
  string fee_address = 1;
}
```

### CLI Usage

```shell
# Send tokens to the fee address (forwarded to protocol revenue in next block)
celestia-appd tx bank send mykey celestia1feefeefeefeefeefeefeefeefeefeefe8pxlcf 1000000utia

# Query the fee address
celestia-appd query feeaddress fee-address
```

## Parameters

This module introduces no new parameters.

## Rationale

### Why Not Direct Transfer to Fee Collector?

A simpler design would transfer tokens directly in EndBlocker:

```go
bankKeeper.SendCoins(ctx, feeAddress, feeCollectorModule, balance)
```

This doesn't work because dashboards calculate revenue by aggregating `tx.AuthInfo.Fee` fields. Direct bank transfers don't create transactions, so contributions would be invisible to analytics without requiring every dashboard provider to add special-case logic for this module.

### Why Forward to Revenue Instead of Burn?

Both approaches achieve the goal of "contributing" to Celestia but have different outcomes:

| Approach | Economic Effect | Dashboard Visibility |
|----------|-----------------|---------------------|
| Fee Forwarding | Redistributed to delegators via distribution module | Appears as tx fees |
| Burning | Deflationary, benefits all TIA holders | Not counted as revenue |

This CIP focuses narrowly on the **contribution mechanism**. What Celestia does with collected fees (redistribute, burn, partial burn) is a broader tokenomics decision that affects all protocol revenue and should be addressed in a separate CIP.

### Strict Enforcement

ProcessProposal strictly enforces fee forwarding to ensure:
- No block proposer can "skip" forwarding to keep funds in the fee address
- Consensus on when/how funds are forwarded
- Predictable behavior for applications sending to the fee address

### Other Design Decisions

1. **No minimum balance threshold**: Forward any non-zero balance to minimize complexity. Very small amounts (e.g., 1 utia) trigger a fee forward tx with effective gas price ~0.00002 utia/gas (1 / 50,000). This is acceptable because protocol-injected txs skip min gas price validation, the contributor is still adding to protocol revenue, and block overhead is minimal (~100 bytes). Adding a threshold would delay forwarding and increase complexity.
2. **One fee forward per block**: All contributions in the fee address are batched into a single MsgForwardFees tx (~100 bytes overhead)
3. **Unsigned transaction**: Validated via ProcessProposal fee balance check, not signature
4. **Gas limit**: 50,000 (minimal - message handler only emits an event)

## Backwards Compatibility

This is a consensus-breaking change that requires a network upgrade. However, it is purely additive (new module) and does not affect existing functionality.

## Test Cases

Test cases are available in the reference implementation:

- Unit tests: `x/feeaddress/keeper_test.go`
- Integration tests: `x/feeaddress/test/feeaddress_test.go`

Tests cover successful forwarding, wrong denom rejection, IBC rejection, event emission, and ProcessProposal validation.

## Security Considerations

1. **Denom Restriction**: Only `utia` can be sent to the fee address. This is enforced by ante decorators and IBC middleware. This prevents IBC tokens or other bridged assets from getting stuck at the fee address with no way to recover them.

2. **IBC Protection**: IBC transfers to the fee address are rejected at the middleware level to prevent foreign tokens from being transferred via IBC.

3. **No Direct Access**: Users cannot withdraw from the fee address. Tokens are automatically forwarded as transaction fees.

4. **Strict Enforcement**: Blocks that fail to forward non-zero balances are rejected, preventing proposers from withholding funds.

5. **Spam Resistance**: The fee forward transaction is created by the block proposer in PrepareProposal, not sourced from the mempool. Users cannot prevent its inclusion by filling blocks with spam. A malicious proposer could omit it, but ProcessProposal would reject their block—tokens remain in the fee address until the next honest proposer.

6. **Low-Value Contributions**: Sending very small amounts (e.g., 1 utia per block) is not an attack vector. Each contribution still adds to protocol revenue, the fee forward tx is minimal (~100 bytes), and gas price validation is intentionally skipped. The only observable effect is inflated transaction counts on dashboards, though revenue attribution remains accurate.

## Reference Implementation

The implementation is available at: <https://github.com/celestiaorg/celestia-app/pull/6407>

## Copyright

Copyright and related rights waived via [CC0](https://github.com/celestiaorg/CIPs/blob/main/LICENSE).
