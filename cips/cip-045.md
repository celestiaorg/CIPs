| cip | 45 |
| - | - |
| title | Forwarding Module |
| description | Enable cross-chain token forwarding via Hyperlane warp routes |
| author | Manav Aggarwal ([@Manav-Aggarwal](https://github.com/Manav-Aggarwal)) |
| discussions-to | |
| status | Draft |
| type | Standards Track |
| category | Core |
| created | 2026-01-19 |
| requires | [CIP-32](./cip-032.md) |

## Abstract

This proposal introduces a forwarding module (`x/forwarding`) that facilitates cross-chain token transfers through Hyperlane warp routes. Users deposit tokens at deterministically derived forwarding addresses, and relayers permissionlessly execute transfers to pre-committed destinations.

## Motivation

Currently, transferring tokens via Hyperlane through Celestia (source chain → Celestia → destination chain) requires users to sign multiple transactions: one on the source chain and another on Celestia to complete the second hop. This module simplifies the experience to a single signature on the source chain. It also enables exchanges to withdraw TIA directly to a user's destination address on another chain. The design allows anyone to trigger the forwarding permissionlessly while cryptographically guaranteeing tokens can only reach the pre-committed destination. This complements IBC Packet Forward Middleware by providing equivalent functionality for Hyperlane transfers.

## Specification

The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in RFC 2119 and RFC 8174.

### New Module: `x/forwarding`

The forwarding module enables cross-chain token transfers via Hyperlane warp routes with a single-signature user experience.

### Address Derivation

Forwarding addresses are derived deterministically from the destination domain and recipient:

```text
callDigest = sha256(destDomain_32bytes || destRecipient)
salt = sha256(version_byte || callDigest)  // version_byte = 0x01
forwardAddr = address.Module("forwarding", salt)[:20]
```

This produces one unique address per `(destDomain, destRecipient)` pair.

### Message Types

```protobuf
message MsgForward {
  string relayer = 1;
  string forward_address = 2;
  uint32 destination_domain = 3;
  bytes destination_recipient = 4;
}

message MsgForwardResponse {
  repeated TokenForwardResult results = 1;
}

message MsgUpdateParams {
  string authority = 1;
  Params params = 2;
}
```

### Supported Tokens

| Source | Format | Method |
|--------|--------|--------|
| Warp transfer | `hyperlane/{tokenId}` | Synthetic transfer |
| CEX (TIA) | `utia` | Collateral transfer |

### Multi-Token Handling

The module processes a set number of token balances (initially set to 20) at a time. If more tokens exist at the forwarding address, subsequent `MsgForward` transactions can process the remaining balances.

### Relayers

Relayers are off-chain services that monitor forwarding addresses for deposits and submit `MsgForward` transactions to trigger the transfer. Relayers are unincentivized initially.

### Operational Flow

1. Frontend derives the forwarding address using destination domain and recipient
2. User transfers tokens to this address
3. Relayer detects the deposit and submits `MsgForward`
4. Module validates the address derivation and executes the warp transfer
5. Tokens appear at the destination recipient's address on the target chain

### Events

```protobuf
message EventTokenForwarded {
  string forward_address = 1;
  string denom = 2;
  string amount = 3;
  string message_id = 4;
  bool success = 5;
  string error = 6;
}

message EventForwardingComplete {
  string forward_address = 1;
  uint32 destination_domain = 2;
  bytes destination_recipient = 3;
  uint32 successful_count = 4;
  uint32 failed_count = 5;
}
```

## Parameters

| Parameter | Proposed value | Description | Changeable via Governance |
|-----------|----------------|-------------|---------------------------|
| `forwarding.MinForwardAmount` | 0 | Minimum amount required to forward (0 = disabled) | Yes |

## Rationale

The forwarding address design cryptographically binds the destination to the address, enabling permissionless execution while guaranteeing funds can only go to the intended recipient.

## Backwards Compatibility

This is a consensus-breaking change that requires a network upgrade. However, it is purely additive (new module, new message types) and does not affect existing functionality.

## Test Cases

Test cases are available in the reference implementation:

- Integration tests: PR #6419
- Test vectors for address derivation cross-platform validation (Go, TypeScript, Rust)

## Security Considerations

1. **Cryptographic Binding**: Forwarding addresses cryptographically commit to specific destinations. Funds deposited at a forwarding address can only be transferred to the pre-committed destination.

2. **Permissionless Safety**: Anyone can trigger forwarding, but execution is restricted to the pre-committed target. This enables permissionless relaying without risk of fund misdirection.

3. **User Error Handling**: If a user sends tokens to an incorrect forwarding address (e.g., wrong destination domain or recipient), those tokens become stuck. The user cannot recover them because no one controls the private key for that address. Users MUST verify the forwarding address matches their intended destination before depositing. Note: if tokens are sent to a forwarding address for a destination domain that is not yet live, forwarding can be retried once that domain becomes available.

4. **Collision Resistance**: Address security is equivalent to standard Cosmos address security (160-bit truncation).

## Reference Implementation

The implementation is available at:

- <https://github.com/celestiaorg/celestia-app/pull/6416>
- <https://github.com/celestiaorg/celestia-app/pull/6417>
- <https://github.com/celestiaorg/celestia-app/pull/6418>
- <https://github.com/celestiaorg/celestia-app/pull/6419>

## Copyright

Copyright and related rights waived via [CC0](https://github.com/celestiaorg/CIPs/blob/main/LICENSE).
